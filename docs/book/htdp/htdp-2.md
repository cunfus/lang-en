# 数、表达式和简单程序

lisp 编写程序时使用了前缀表达式。在计算中也是，每个表达式的形式皆为：

`(operation A ... B)`

因此，不存在先计算哪个部分，当 `A ... B` 都是数，就可以进行计算，否则需要先对 `A ... B` 计算。

因为经常会有除不尽的情况，Lisp 可以用精确值作为结果（也就是分数）。对无理数，如根号三，计算结果会用 `#` 表示这是一个近似。

到了函数这里，以往的语言学习中，函数是一个过程，一个映射，或者一个动作。在函数式编程中，函数作为一等公民，它是一个规则，从一些数据产生另一些数据。

```scheme
(define (area-of-disk r)
  (* 3.14 (* r r)))

(define (area-of-ring outer inner)
  (- (area-of-disk outer)
     (area-of-disk inner)))

(area-of-ring 5 3)
```

怎么设计程序？

书里给出的建议，

**理解程序的目的**：创建一个接受输入并产生结果的机制。给每一个程序有意义的名字，并说明输入数据和所产生数据的类型，这成为程序的合约（在有些语言中，这被称为函数原型或函数签名。）。比如上面示例的合约是

`;; area-of-ring : number number -> number`

其中，分号表示该行是一个注释。合约包含两个部分，冒号的左边是程序的名字，右边是输入和输出的类型，输入和输出之间用箭头隔开。

有了合约，就可以在程序中加入函数头部，函数头部复述程序的名字，同时给每个输入一个不同的名字，这些名字是变量，是程序的参数。

```scheme
;; area-of-ring : number number -> number
(define (area-of-ring outer inner) ...)
```

最后，根据合约和参数，简要说明一下程序的用途，它是程序要完成的任务的简短注释。

```scheme
;; area-of-ring : number number -> number
;; 计算一个半径为 outer，洞的半径为 inner 的圆环的面积
(define (area-of-ring outer inner) ...)
```

这个过程要把给定的事实和要计算的数据分开，如果给的是一个固定值，它很可能在程序中出现。如果给的是未知数，它就是一个输入。

**例子**：这是为了更好的了解程序要计算什么，需要构造一些输入并确定输出到底是什么。

`;; example: (area-of-ring 5 3) 的结果是 50.24 `

例子可以帮助我们发现逻辑错误，同时思考数据计算的过程。它也是用途说明的一种表达，方便未来者阅读。


**程序体**：阐明程序体，将头部的 `...` 替换为表达式。如果输入输出的关系由数学公式给出，那么只要翻译数学公式就行了。如果这种关系隐藏在书面叙述中，就要细心挖掘其中信息并构造相应表达式。

```scheme
(define (area-of-ring outer inner)
  (- (area-of-disk outer)
     (area-of-disk inner)))
```

**测试**：完成程序定义，还必须测试程序。测试的目的不是要验证所有的结果都是对的，而是尽量找出语法错误、逻辑错误和运行问题。

以上，这些设计秘诀不是解决程序设计中所有问题的灵丹妙药，它只是提供了一些指导。**我们的配方中最具创意和最困难的一步涉及程序主体的设计。在这一点上，它在很大程度上依赖于我们阅读和理解书面材料的能力、提取数学关系的能力以及我们对基本事实的了解。这些技能都不是计算机程序开发所特有的；我们利用的知识特定于我们正在工作的应用程序领域。**


**领域知识**：制定程序的主体通常需要有关问题所在的领域（也称为领域）的知识。这种形式的知识称为领域知识。​​​​​​​它可能必须来自简单的数学，如算术，复杂的数学，如微分方程，或非数学学科：音乐、生物学、土木工程、艺术等。程序员无法了解计算的所有应用领域，因此他们必须准备好理解该语言各种应用领域的知识，以便他们可以与领域专家讨论问题。这种语言通常是数学语言，但在某些情况下，程序员必须发明一种语言，尤其是应用程序领域的数据语言。

（上面这两大段原文的内容，很重要。不少人囿于一片很小的点上，以为自己掌握的那部分是真理，这是一种很有害的心态。）

## 练习

### 2.1.1

DrScheme 没有平方操作，正弦和最大值的操作是有的，`(sin 1)` `(max 1 5 7 2 4)`。

### 2.1.2

也具备正切值计算，`(tan 1)`

### 2.2.1

```scheme
(define (Fahrenheit->Celsius c)
  (+ (* c (/ 9 5)) 32))

(Fahrenheit->Celsius 36)
```
软件包暂时不找了，等后面 GUI 看完了，试着做一个。

### 2.2.2

```scheme
; 1 dollar -> 0.8935 eur
(define (dollar->euro d)
  (* d 0.8935))

(dollar->euro 20)
```

### 2.2.3

```scheme
; area = bottom * height / 2
(define (triangle b h)
  (/ (* b h) 2))

(triangle 3 4)
```

### 2.2.4

```scheme
(define (convert3 units tens hundreds)
  (+ units (* tens 10) (* hundreds 100)))

(convert3 1 2 3)
```

### 2.2.5

```scheme
(define (h1 n)
  (+ (* n n) 10))

(define (h2 n)
  (+ (/ (* n n) 2) 20))

(define (h3 n)
  (- 2 (/ 1 n)))

(h1 3) ; 19
(h2 4) ; 28
(h3 5) ; 1.8
```

### 2.3.1

```scheme
(define (tax wage)
  (* wage 0.15))

(define (netpay wage)
  (- wage (tax wage)))

(netpay 100)
```

### 2.3.2

```scheme
(define (sum-coins 1count 5count 10count 25count)
  (+ 1count (* 5count 5) (* 10 10count) (* 25 25count)))
```

### 2.3.3

```scheme
(define (total-profit x)
  (- (* x 5) (* x 0.5) 20))

(total-profit 5)
```
 